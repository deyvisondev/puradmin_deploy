<%- include("partials/header") %>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

  <!-- Content Header (Page header) -->
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0">Dashboard</h1>
        </div><!-- /.col -->
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Home</a></li>
            <li class="breadcrumb-item active">Dashboard</li>
          </ol>
        </div><!-- /.col -->
      </div><!-- /.row -->
    </div><!-- /.container-fluid -->
  </div>
  <!-- /.content-header -->

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">
      <!-- Small boxes (Stat box) -->
      <div class="row">
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
              <h3>
                <%= events %>
              </h3>

              <p>Ocorrências</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <a href="/admin/event-list" class="small-box-footer">Mais Informações <i
                class="fas fa-arrow-circle-right"></i></a>
          </div>
        </div>

        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
              <h3>
                <%= clients %>
              </h3>

              <p>Clientes</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <a href="/admin/client-list" class="small-box-footer">Mais Informações <i
                class="fas fa-arrow-circle-right"></i></a>
          </div>
        </div>

        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
              <h3>
                <%= users %>
              </h3>

              <p>Usuários</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <a href="/admin/user-list" class="small-box-footer">Mais Informações <i
                class="fas fa-arrow-circle-right"></i></a>
          </div>
        </div>

        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
              <h3>
                <%= products %>
              </h3>

              <p>Produtos</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <a href="/admin/list-product" class="small-box-footer">Mais Informações <i
                class="fas fa-arrow-circle-right"></i></a>
          </div>
        </div>
      </div>
      <!-- /.row -->
      <div class="row">
        <div class="col-lg-3 col-6">
          <!-- small box -->
          <div class="small-box bg-info">
            <div class="inner">
              <h3>
                <%= todayevents %>
              </h3>

              <p>Ocorrências do Dia</p>
            </div>
            <div class="icon">
              <i class="ion ion-stats-bars"></i>
            </div>
            <a href="/admin/list-event" class="small-box-footer">Mais Informações <i
                class="fas fa-arrow-circle-right"></i></a>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="card card-success">
            <div class="card-header">
              <h3 class="card-title">Ocorrências Diárias no Picking</h3>

              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                  <i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart">
                <canvas id="myChart"
                  style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
            <!-- /.card-body -->
          </div>
        </div>
        <div class="col-md-6">
          <div class="card card-success">
            <div class="card-header">
              <h3 class="card-title">Ocorrências Diárias por Departamento</h3>

              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                  <i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart">
                <canvas id="pieChart"
                  style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
            <!-- /.card-body -->
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card card-success">
            <div class="card-header">
              <h3 class="card-title">Ocorrências Diárias no Picking</h3>

              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                  <i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart">
                <label for="start">Início:</label>
                <input type="date" id="start" name="date_start" onchange="startDateFilter(this)" value="2022-11-15"
                  min="2022-11-01" max="2022-11-30">
                <label for="start">Fim:</label>
                <input type="date" id="end" name="date_end" onchange="endDateFilter(this)" value="2022-11-26"
                  max="2022-11-26">
                <canvas id="chart"
                  style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
            <!-- /.card-body -->
          </div>
        </div>
        <div class="col-md-6">
          <div class="card card-success">
            <div class="card-header">
              <h3 class="card-title">Ocorrências Diárias por Departamento</h3>

              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                  <i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="remove">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart">
                <canvas id="pie2"
                  style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%;"></canvas>
              </div>
            </div>
            <!-- /.card-body -->
          </div>
        </div>
      </div>



      <script>
        const ctx = document.getElementById('myChart');

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Jorge', 'Estevão', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
              label: 'Ocorrências',
              data: [0, 2, 19, 3, 5, 2, 3],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        const pie = document.getElementById('pieChart');

        new Chart(pie, {
          type: 'pie',
          data: {
            labels: ['Jorge', 'Estevão', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
              label: 'Ocorrências',
              data: [0, '<%= clients %>', 19, 3, 5, 2, 3],
              borderWidth: 1
            }]
          },
          options: {

          }
        });


        //Variáveis que receberão os dados para popular o gráfico


        // function calculateMin() {
        //   const date = new Date()
        //   const dateMoment = moment(date).subtract(7, 'days').format("YYYY-MM-DD")
        //   console.log(dateMoment)
        // }


        const data = [];

        const quantidade = [];


        //Dados recebidos do res.render na rota

        ' <% eventsPerDay.forEach(function(date, count){ %>'

        data.push('<%= date.date %>');
        quantidade.push('<%= date.count %>');
        '<% }); %>'

        var dt = new Date();
        dt.setDate(dt.getDate()-7); 
        
        const config = {
          type: 'bar',
          data: {
            labels: data,
            datasets: [{
              label: 'Ocorrências',
              data: quantidade,
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              x: {
                min: dt.setHours(0, 0, 0, 0),
                max: new Date(),
                type: 'time',
                time: {
                  unit: 'day',
                }
              },
              y: {
                beginAtZero: true
              }
            }
          }
        }


        const myChart = new Chart(
          document.getElementById('chart'),
          config
        );


        function startDateFilter(date) {
          const startDate = date.value
          console.log(startDate)
          myChart.options.scales.x.min = startDate
          myChart.update()
        }

        function endDateFilter(date) {
          const endDate = date.value
          console.log(endDate)
          myChart.options.scales.x.max = endDate
          myChart.update()
        }

        //Doughnut chart definido no canvas da página

        //var ctx = document.getElementById('pie-chart').getContext('2d');
      </script>






    </div><!-- /.container-fluid -->
  </section>
  <!-- /.content -->


  <%- include("partials/footer") %>